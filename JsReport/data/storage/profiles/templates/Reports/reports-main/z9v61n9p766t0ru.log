{"type":"operationStart","subtype":"profile","data":{"_id":"0iwOu2Fdxv8qxJTG","timestamp":"2024-01-12T15:52:18.028Z","state":"queued","mode":"standard","creationDate":"2024-01-12T15:52:18.030Z","modificationDate":"2024-01-12T15:52:18.030Z","shortid":"IEw0iDb","$entitySet":"profiles"},"doDiffs":false,"timestamp":1705074738029,"id":"ti7ku6uhi498dyy","previousOperationId":null,"operationId":"cpfxabm7liaejsv"}
{"type":"log","level":"info","message":"Render request 18 queued for execution and waiting for available worker","previousOperationId":"cpfxabm7liaejsv","timestamp":1705074738029,"id":"av3bm4qb4p16d3l"}
{"type":"operationStart","subtype":"render","name":"reports-main","previousOperationId":"cpfxabm7liaejsv","timestamp":1705074738039,"id":"745pnz61jop69yy","previousEventId":"ti7ku6uhi498dyy","operationId":"4r56nmhyt8ndeh3"}
{"type":"log","timestamp":1705074738039,"level":"info","message":"Starting rendering request 18","meta":{"rootId":"z9v61n9p766t0ru","id":"z9v61n9p766t0ru"},"id":"6gs7vhrzyk0azcn","previousOperationId":"4r56nmhyt8ndeh3"}
{"type":"log","timestamp":1705074738039,"level":"info","message":"Rendering template { name: reports-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"z9v61n9p766t0ru","id":"z9v61n9p766t0ru"},"id":"jljmw3a55217wje","previousOperationId":"4r56nmhyt8ndeh3"}
{"type":"log","timestamp":1705074738040,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"z9v61n9p766t0ru","id":"z9v61n9p766t0ru"},"id":"1pf8lzowz8tag4f","previousOperationId":"4r56nmhyt8ndeh3"}
{"type":"log","timestamp":1705074738044,"level":"debug","message":"Executing script reports-script (beforeRender)","meta":{"rootId":"z9v61n9p766t0ru","id":"z9v61n9p766t0ru"},"id":"lnot8yp7qlgnur3","previousOperationId":"4r56nmhyt8ndeh3"}
{"type":"operationStart","subtype":"scriptsBeforeRender","name":"scripts beforeRender","timestamp":1705074738068,"id":"f9fb5tls8zeqvcr","previousEventId":"745pnz61jop69yy","operationId":"hmk7vvum6gmejtj","previousOperationId":"4r56nmhyt8ndeh3"}
{"type":"operationStart","subtype":"script","name":"scripts reports-script","previousOperationId":"hmk7vvum6gmejtj","timestamp":1705074738068,"id":"r0q811935jndu3l","previousEventId":"f9fb5tls8zeqvcr","operationId":"5s4neek57bw8ehm"}
{"type":"log","timestamp":1705074738100,"level":"debug","message":"(console:log) [\n  {\n    id: 1,\n    number: 2,\n    firstStop: 'C',\n    lastStop: 'D',\n    createdAt: '2023-12-01T17:35:52.000Z',\n    updatedAt: '2023-12-12T20:01:36.000Z'\n  },\n  {\n    id: 2,\n    number: 66,\n    firstStop: 'TF',\n    lastStop: 'VG',\n    createdAt: '2023-12-01T19:20:40.000Z',\n    updatedAt: '2023-12-01T19:20:40.000Z'\n  },\n  {\n    id: 3,\n    number: 69,\n    firstStop: 'Si',\n    lastStop: 'No',\n    createdAt: '2023-12-04T17:13:35.000Z',\n    updatedAt: '2023-12-04T17:13:35.000Z'\n  },\n  {\n    id: 4,\n    number: 22,\n    firstStop: 'FG',\n    lastStop: 'DF',\n    createdAt: '2023-12-08T18:39:03.000Z',\n    updatedAt: '2023-12-08T18:39:03.000Z'\n  },\n  {\n    id: 5,\n    number: 1,\n    firstStop: 'A',\n    lastStop: 'B',\n    createdAt: '2023-12-12T19:54:23.000Z',\n    updatedAt: '2023-12-12T19:54:23.000Z'\n  }\n]","meta":{"userLevel":true,"rootId":"z9v61n9p766t0ru","id":"z9v61n9p766t0ru"},"id":"cqs7kv7s6k0fa97","previousOperationId":"5s4neek57bw8ehm"}
{"type":"log","timestamp":1705074738106,"level":"debug","message":"(console:log) [\n  {\n    id: 14,\n    Location: 'ss',\n    idLine: 1,\n    filename: 'image-1701457483207.jpg',\n    createdAt: '2023-12-01T19:04:43.000Z',\n    updatedAt: '2023-12-01T19:04:43.000Z'\n  },\n  {\n    id: 17,\n    Location: 'Si',\n    idLine: 1,\n    filename: 'image-1702411966104.jpg',\n    createdAt: '2023-12-12T20:12:46.000Z',\n    updatedAt: '2023-12-12T20:12:46.000Z'\n  }\n]","meta":{"userLevel":true,"rootId":"z9v61n9p766t0ru","id":"z9v61n9p766t0ru"},"id":"iq4op3v6qxj11ce","previousOperationId":"5s4neek57bw8ehm"}
{"type":"log","timestamp":1705074738110,"level":"warn","message":"Error when processing render request 18\n(because) error when evaluating custom script /templates/Reports/reports-script\ndata is not defined\n\n(sandbox.js line 38:9)\n\n  36 |     console.log(req.data.busstops)\n  37 |\n> 38 |         data.busstops.forEach(busstop => {\n     |         ^\n  39 |         busstop.locationCount = getLocationCount(busstop.idLine, data.busstops);\n  40 |     });\n  41 | }\n\n\nReferenceError: data is not defined\n    at Object.beforeRender (sandbox.js:38:9)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async executionFn (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:67:11)\n    at async run (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:137:16)\n    at async WorkerReporter.runInSandbox [as _runInSandbox] (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:195:14)\n    at async executeScript (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:122:12)\n    at async Scripts._runScript (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:140:30)\n    at async Scripts.handleBeforeRender (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:64:7)\n    at async ListenerCollection.fire (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\shared\\listenerCollection.js:157:21)\n    at async beforeRender (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\render\\render.js:24:5)","meta":{"rootId":"z9v61n9p766t0ru","id":"z9v61n9p766t0ru"},"id":"jnasn966bnp9rac","previousOperationId":"5s4neek57bw8ehm"}
{"type":"log","timestamp":1705074738110,"level":"warn","message":"Rendering request 18 finished with error in 83 ms","meta":{"rootId":"z9v61n9p766t0ru","id":"z9v61n9p766t0ru"},"id":"hrri7vglhbhod5d","previousOperationId":"5s4neek57bw8ehm"}
{"type":"error","timestamp":1705074738116,"statusCode":400,"weak":true,"lineNumber":38,"decoratedSuffix":"\n\n(sandbox.js line 38:9)\n\n  36 |     console.log(req.data.busstops)\n  37 |\n> 38 |         data.busstops.forEach(busstop => {\n     |         ^\n  39 |         busstop.locationCount = getLocationCount(busstop.idLine, data.busstops);\n  40 |     });\n  41 | }\n\n","entity":{"shortid":"vVn-6F0Ydc","name":"reports-script","content":"// server side script fetching remote data and preparing report data source\nconst axios = require('axios');\n\nfunction getLocationCount(idLine, busstops) {\n    let count = 0;\n    for (let i = 0; i < busstops.length; i++) {\n        if (busstops[i].idLine === idLine) {\n            count++;\n        }\n    }\n    return count;\n}\n\n// call remote http rest api\nfunction fetchReport() {\n    return new Promise((resolve, reject) => {\n        axios.get('http://localhost:8080/api/line').then(lines =>{\n            resolve(lines.data)\n        })\n    })\n}\n\nfunction fetchBusStops() {\n        return new Promise((resolve, reject) => {\n        axios.get('http://localhost:8080/api/bus_stop/1').then(busstops =>{\n            resolve(busstops.data)\n        })\n    })\n}\n\n// add jsreport hook which modifies the report input data\nasync function beforeRender(req, res) {\n    req.data.lines = await fetchReport()\n    console.log(req.data.lines)\n    req.data.busstops= await fetchBusStops()\n    console.log(req.data.busstops)\n\n        data.busstops.forEach(busstop => {\n        busstop.locationCount = getLocationCount(busstop.idLine, data.busstops);\n    });\n}\n\n"},"property":"content","logged":true,"previousOperationId":"5s4neek57bw8ehm","id":"mzg0k3hwz88lpic","stack":"ReferenceError: data is not defined\n    at Object.beforeRender (sandbox.js:38:9)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async executionFn (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:67:11)\n    at async run (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:137:16)\n    at async WorkerReporter.runInSandbox [as _runInSandbox] (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:195:14)\n    at async executeScript (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:122:12)\n    at async Scripts._runScript (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:140:30)\n    at async Scripts.handleBeforeRender (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:64:7)\n    at async ListenerCollection.fire (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\shared\\listenerCollection.js:157:21)\n    at async beforeRender (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\render\\render.js:24:5)","message":"Error when evaluating custom script /templates/Reports/reports-script\ndata is not defined\n\n(sandbox.js line 38:9)\n\n  36 |     console.log(req.data.busstops)\n  37 |\n> 38 |         data.busstops.forEach(busstop => {\n     |         ^\n  39 |         busstop.locationCount = getLocationCount(busstop.idLine, data.busstops);\n  40 |     });\n  41 | }\n\n"}
