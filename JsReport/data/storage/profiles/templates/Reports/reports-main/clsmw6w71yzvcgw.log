{"type":"operationStart","subtype":"profile","data":{"_id":"QCSlxCYcJFogJgQP","timestamp":"2024-01-12T15:20:16.892Z","state":"queued","mode":"standard","creationDate":"2024-01-12T15:20:16.918Z","modificationDate":"2024-01-12T15:20:16.918Z","shortid":"c92Nrj4","$entitySet":"profiles"},"doDiffs":false,"timestamp":1705072816916,"id":"5h2e8ne3n05h511","previousOperationId":null,"operationId":"utuwa9ygz58wkd6"}
{"type":"log","level":"info","message":"Render request 2 queued for execution and waiting for available worker","previousOperationId":"utuwa9ygz58wkd6","timestamp":1705072816917,"id":"nu8itdhvo2qxijs"}
{"type":"operationStart","subtype":"render","name":"reports-main","previousOperationId":"utuwa9ygz58wkd6","timestamp":1705072816947,"id":"797vz4u2uax17nz","previousEventId":"5h2e8ne3n05h511","operationId":"pcy33c70oypz66r"}
{"type":"log","timestamp":1705072816949,"level":"info","message":"Starting rendering request 2","meta":{"rootId":"clsmw6w71yzvcgw","id":"clsmw6w71yzvcgw"},"id":"wbouwkeictdjgsc","previousOperationId":"pcy33c70oypz66r"}
{"type":"log","timestamp":1705072816952,"level":"info","message":"Rendering template { name: reports-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"clsmw6w71yzvcgw","id":"clsmw6w71yzvcgw"},"id":"ruvafk6cv0cssqd","previousOperationId":"pcy33c70oypz66r"}
{"type":"log","timestamp":1705072816960,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"clsmw6w71yzvcgw","id":"clsmw6w71yzvcgw"},"id":"7zmv084t84vsx7f","previousOperationId":"pcy33c70oypz66r"}
{"type":"log","timestamp":1705072816968,"level":"debug","message":"Executing script reports-script (beforeRender)","meta":{"rootId":"clsmw6w71yzvcgw","id":"clsmw6w71yzvcgw"},"id":"g6l38cl06wbtqxv","previousOperationId":"pcy33c70oypz66r"}
{"type":"operationStart","subtype":"scriptsBeforeRender","name":"scripts beforeRender","timestamp":1705072817821,"id":"soamdm3srsh7as6","previousEventId":"797vz4u2uax17nz","operationId":"oxzqncn5aridl1f","previousOperationId":"pcy33c70oypz66r"}
{"type":"operationStart","subtype":"script","name":"scripts reports-script","previousOperationId":"oxzqncn5aridl1f","timestamp":1705072817821,"id":"nzt6g8cgh1ro5at","previousEventId":"soamdm3srsh7as6","operationId":"ijsx6v2turzrkug"}
{"type":"log","timestamp":1705072817912,"level":"debug","message":"(console:log) [\n  {\n    id: 1,\n    number: 2,\n    firstStop: 'C',\n    lastStop: 'D',\n    createdAt: '2023-12-01T17:35:52.000Z',\n    updatedAt: '2023-12-12T20:01:36.000Z'\n  },\n  {\n    id: 2,\n    number: 66,\n    firstStop: 'TF',\n    lastStop: 'VG',\n    createdAt: '2023-12-01T19:20:40.000Z',\n    updatedAt: '2023-12-01T19:20:40.000Z'\n  },\n  {\n    id: 3,\n    number: 69,\n    firstStop: 'Si',\n    lastStop: 'No',\n    createdAt: '2023-12-04T17:13:35.000Z',\n    updatedAt: '2023-12-04T17:13:35.000Z'\n  },\n  {\n    id: 4,\n    number: 22,\n    firstStop: 'FG',\n    lastStop: 'DF',\n    createdAt: '2023-12-08T18:39:03.000Z',\n    updatedAt: '2023-12-08T18:39:03.000Z'\n  },\n  {\n    id: 5,\n    number: 1,\n    firstStop: 'A',\n    lastStop: 'B',\n    createdAt: '2023-12-12T19:54:23.000Z',\n    updatedAt: '2023-12-12T19:54:23.000Z'\n  }\n]","meta":{"userLevel":true,"rootId":"clsmw6w71yzvcgw","id":"clsmw6w71yzvcgw"},"id":"lalij80nvh2zs9f","previousOperationId":"ijsx6v2turzrkug"}
{"type":"log","timestamp":1705072817920,"level":"warn","message":"Error when processing render request 2\n(because) error when evaluating custom script /templates/Reports/reports-script\nfetchBusstops is not defined\n\n(sandbox.js line 26:24)\n\n  24 |     console.log(req.data.lines)\n  25 |     \n> 26 |     req.data.busstops= await fetchBusstops()\n     |                        ^\n  27 |     console.log(req.data.busstops)\n  28 | }\n  29 |\n\n\nReferenceError: fetchBusstops is not defined\n    at Object.beforeRender (sandbox.js:26:24)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async executionFn (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:67:11)\n    at async run (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:137:16)\n    at async WorkerReporter.runInSandbox [as _runInSandbox] (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:195:14)\n    at async executeScript (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:122:12)\n    at async Scripts._runScript (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:140:30)\n    at async Scripts.handleBeforeRender (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:64:7)\n    at async ListenerCollection.fire (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\shared\\listenerCollection.js:157:21)\n    at async beforeRender (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\render\\render.js:24:5)","meta":{"rootId":"clsmw6w71yzvcgw","id":"clsmw6w71yzvcgw"},"id":"0ioz8joj6zb7um5","previousOperationId":"ijsx6v2turzrkug"}
{"type":"log","timestamp":1705072817920,"level":"warn","message":"Rendering request 2 finished with error in 1029 ms","meta":{"rootId":"clsmw6w71yzvcgw","id":"clsmw6w71yzvcgw"},"id":"rmuz12zz8iyr8j8","previousOperationId":"ijsx6v2turzrkug"}
{"type":"error","timestamp":1705072817943,"statusCode":400,"weak":true,"lineNumber":26,"decoratedSuffix":"\n\n(sandbox.js line 26:24)\n\n  24 |     console.log(req.data.lines)\n  25 |     \n> 26 |     req.data.busstops= await fetchBusstops()\n     |                        ^\n  27 |     console.log(req.data.busstops)\n  28 | }\n  29 |\n\n","entity":{"shortid":"vVn-6F0Ydc","name":"reports-script","content":"// server side script fetching remote data and preparing report data source\nconst axios = require('axios');\n\n// call remote http rest api\nfunction fetchReport() {\n    return new Promise((resolve, reject) => {\n        axios.get('http://localhost:8080/api/line').then(lines =>{\n            resolve(lines.data)\n        })\n    })\n}\n\nfunction fetchBusStops(){\n        return new Promise((resolve, reject) => {\n        axios.get('http://localhost:8080/api/bus_stop').then(busstops =>{\n            resolve(busstops.data)\n        })\n    })\n}\n\n// add jsreport hook which modifies the report input data\nasync function beforeRender(req, res) {\n    req.data.lines = await fetchReport()\n    console.log(req.data.lines)\n    \n    req.data.busstops= await fetchBusstops()\n    console.log(req.data.busstops)\n}\n\nasync function beforeRenderA(req, res) {\n    req.data.busstops= await fetchBusstops()\n    console.log(req.data.busstops)\n}"},"property":"content","logged":true,"previousOperationId":"ijsx6v2turzrkug","id":"5u2pxr7romc5c5y","stack":"ReferenceError: fetchBusstops is not defined\n    at Object.beforeRender (sandbox.js:26:24)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async executionFn (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:67:11)\n    at async run (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:137:16)\n    at async WorkerReporter.runInSandbox [as _runInSandbox] (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:195:14)\n    at async executeScript (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:122:12)\n    at async Scripts._runScript (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:140:30)\n    at async Scripts.handleBeforeRender (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:64:7)\n    at async ListenerCollection.fire (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\shared\\listenerCollection.js:157:21)\n    at async beforeRender (C:\\Users\\ratha\\Desktop\\proyectoDesic\\JsReport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\render\\render.js:24:5)","message":"Error when evaluating custom script /templates/Reports/reports-script\nfetchBusstops is not defined\n\n(sandbox.js line 26:24)\n\n  24 |     console.log(req.data.lines)\n  25 |     \n> 26 |     req.data.busstops= await fetchBusstops()\n     |                        ^\n  27 |     console.log(req.data.busstops)\n  28 | }\n  29 |\n\n"}
